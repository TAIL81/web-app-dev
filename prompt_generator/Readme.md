# Prompt Generator: Claude用プロンプト自動生成ツール

## 概要

このPythonスクリプトは、Anthropic社のClaude大規模言語モデルを使用して、特定のタスクを実行するためのプロンプトテンプレートを自動生成するツールです。ユーザーがタスク内容を記述するだけで、Claudeがそのタスクに適したプロンプトの雛形を作成します。生成されたプロンプトは、さらなる改良のための出発点として利用できます。

元々はGoogle Colabノートブックとして開発されたもので、対話的なプロンプトエンジニアリングを支援することを目的としています。

## 特徴

-   **Metapromptベースの生成**: 詳細な指示と多様な例を含む「Metaprompt」を利用して、高品質なプロンプトテンプレートを生成します。
-   **タスク指向**: ユーザーが実行したいタスクを自然言語で指定するだけで、対応するプロンプトが生成されます。
-   **変数対応**: プロンプトテンプレート内で使用する変数をユーザーが指定できます。指定しない場合は、Claudeが適切な変数を提案します。
-   **品質向上機能**:
    -   生成されたプロンプトから不要な空タグを削除します。
    -   「浮動変数」（XMLタグで適切に囲まれていない変数）を検出し、修正する機能が含まれています。これにより、プロンプトの文法的な正しさや意図した動作が保証されやすくなります。
-   **即時テスト**: 生成されたプロンプトテンプレートに具体的な値を入力し、すぐにClaudeでテスト実行して結果を確認できます。
-   **モデル選択**: 使用するClaudeモデル（例: `claude-3-5-sonnet-20240620`）を指定できます。

## 前提条件

-   Python 3.x
-   `anthropic` Pythonライブラリ
-   Anthropic APIキー

## セットアップ

1.  **ライブラリのインストール**:
    ```bash
    pip install anthropic
    ```
2.  **APIキーの設定**:
    スクリプト内の以下の部分にご自身のAnthropic APIキーを設定してください。
    ```python
    ANTHROPIC_API_KEY = "" # ここにAPIキーを入力してください！
    ```
3.  **(オプション) モデル名の確認・変更**:
    デフォルトでは `claude-3-5-sonnet-20240620` が使用されます。必要に応じて `MODEL_NAME` 変数を変更してください。
    ```python
    MODEL_NAME = "claude-3-5-sonnet-20240620"
    ```

## 使用方法

1.  **タスクの指定**:
    スクリプト内の `TASK` 変数に、プロンプトを生成させたいタスクを文字列で記述します。
    ```python
    TASK = "顧客からの苦情に対応するメールを作成する" # あなたのタスクに置き換えてください！
    ```
2.  **(オプション) 変数の指定**:
    プロンプトテンプレートに含めたい変数を `VARIABLES` リストに文字列で指定します。変数は大文字で記述することが推奨されます（例: `CUSTOMER_COMPLAINT`）。
    ```python
    # 例:
    # VARIABLES = ["CUSTOMER_COMPLAINT", "COMPANY_NAME"]
    VARIABLES = [] # Claudeに変数を選ばせる場合は空リストのままにします
    ```
    `VARIABLES` が空リストの場合、Claudeがタスク内容に基づいて適切な変数を提案します。

3.  **スクリプトの実行**:
    Pythonスクリプトを実行します。
    ```bash
    python prompt_generator.py
    ```
    実行すると、まずClaudeが選択または指定された変数と、生成されたプロンプトテンプレートがコンソールに出力されます。

4.  **浮動変数のチェックと修正 (自動)**:
    生成されたプロンプトテンプレートに「浮動変数」（不適切に使用されている可能性のある変数）が含まれている場合、スクリプトは自動的にこれを検出し、修正を試みます。修正後のプロンプトテンプレートが再度表示されます。

5.  **プロンプトのテスト**:
    スクリプトの最後に、プロンプトテンプレートに含まれる各変数について、具体的な値を入力するよう求められます。
    ```
    Enter value for variable: CUSTOMER_COMPLAINT
    （ここに顧客の苦情内容を入力）
    Enter value for variable: COMPANY_NAME
    （ここに会社名を入力）
    ```
    全ての値を入力すると、それらの値が埋め込まれたプロンプトがClaudeに送信され、最終的な応答がコンソールに出力されます。

## 主要な処理の流れ

1.  ユーザーが `TASK` とオプションで `VARIABLES` を設定します。
2.  これらの情報が `metaprompt`（プロンプト生成のための詳細な指示）に組み込まれます。
3.  `metaprompt` がClaude APIに送信され、初期のプロンプトテンプレートが返されます。
4.  初期プロンプトテンプレートから、`extract_prompt` 関数により主要な指示部分が抽出され、不要な部分が整形されます。
5.  `find_free_floating_variables` 関数で、XMLタグで囲まれていない不適切な変数使用（浮動変数）がないかチェックされます。
6.  浮動変数が見つかった場合、`remove_inapt_floating_variables` 関数が専用のプロンプト (`remove_floating_variables_prompt`) を使用してClaudeに再度問い合わせ、浮動変数を修正したプロンプトテンプレートを取得します。
7.  最終的に整形・修正されたプロンプトテンプレートと、使用される変数が表示されます。
8.  ユーザーが各変数に値を入力すると、完成したプロンプトでClaude APIが呼び出され、結果が表示されます。

## 注意点

-   このツールは主にシングルターンの質問応答形式のプロンプト生成に適しています。複数ターンにわたる対話用のプロンプト生成には最適化されていません。
-   `metaprompt` は元々Claude 3 Opusでの使用を想定して設計されています。他のモデル（`MODEL_NAME` で指定）を使用する場合、生成されるプロンプトの品質が変わることがあります。
-   生成されるプロンプトはあくまで出発点であり、必ずしも最適であるとは限りません。期待する結果が得られるよう、適宜手動で調整・改良してください。
-   Anthropic APIの利用にはコストが発生する場合があります。利用規約と料金体系をご確認ください。